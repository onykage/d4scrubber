<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="../../css/general.css" />
  <link rel="stylesheet" href="../../css/header.css" />
  <link rel="stylesheet" href="../../css/ingame.css" />
  <link rel="stylesheet" href="../../css/modal.css" />
  <title>Menu</title>
  <style>
    </style>
<script defer src="js/in_game.js"></script></head>
<body class="in-game" style="background-color:rgba(0, 0, 0, 0);">
  <!-- -------------------------------- Header ------------------------------- -->

  <header style="display: none;" id="header" class="app-header">
    <img src="../../img/header_icon.svg" />
    <h1 class="hotkey-text">
      Show/Hide Hotkey:
      <kbd id="hotkey"></kbd>
    </h1>
    <div class="window-controls-group">
      <button id="minimizeButton" class="window-control window-control-minimize" />
      <button id="maximizeButton" class="window-control window-control-maximize" />
      <button id="closeButton" class="window-control window-control-close" />
    </div>
  </header>

  <!-- --------------------------------- Main -------------------------------- -->
  <main style="background: rgba(0, 0, 0, 0);">
    <div id="logs">
      <div id="events" class="logColumn">
        <h1>Game Events</h1>
        <div id="eventsLog" class="dataText" style="overflow: scroll; width: 350px;">
        </div>
      </div>
      <div id="infoUpdates" class="logColumn">
        <h1>Info Updates</h1>
        <div id="infoLog" class="dataText"></div>
      </div>
    </div>
    <div id="other">
      <h1>Real-time Game Data</h1>
      <p id="infoParagraph">
        The background controller of this app is listening to all the game
        events and info updates, and sends them to this window, that prints
        them to the screen. Some specific events (Match Start/End, Kill and
        Death) are painted in <span style="color: #00DEFA">teal</span> and
        logged to the developers console.
      </p>
    </div>
  </main>
  <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script>
    // Standard Google Universal Analytics code
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      },
        i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      // Note: https protocol here
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-144253676-3', 'auto');

    // Removes failing protocol check. @see: http://stackoverflow.com/a/22152353/1958200
    ga('set', 'checkProtocolTask', function () { });
    ga('require', 'displayfeatures');
    ga('send', 'pageview', '/in_game.html');
  </script>
  <script type="text/javascript">
    //document.addEventListener("click", function(event) {
    //  alert("clientX: " + event.clientX + " - clientY: " + event.clientY);
    //});
    document.addEventListener('keydown', function(event) {
      // Check for Ctrl+Shift+F
      if (event.ctrlKey && event.shiftKey && event.key === 'F') {
        // Your action here
        //alert('Hotkey Ctrl+Shift+F was pressed!');
        //uncomment to use html2canvas
        
        //overwolf
        //var settings = {"crop": {x:299,y:194, width:82, height:82}, "rescale" :{width:42, height:42}};
        var gameimage = '';
        overwolf.media.takeScreenshot(function(info) {
          if (typeof info.url === 'undefined') {
            console.error(info);
            return;
          }
          //gameimage = info.url;
          document.getElementById("eventsLog").innerHTML = "<img src='"+info.url+"' />"; 

          overwolf.windows.sendMessage('background', '1', info.url, ()=>{console.log('Message sent to window "secondWindow"')})
          console.log("sending Data:" + info.url);
          
        });


        //const screenshotTarget = document.body;
        //html2canvas(screenshotTarget).then(canvas => {
          // to image as png use below line
          //const base64image = canvas.toDataURL("image/png");
          // show the image in window use below line
          //window.location.href = base64image;
          
          // screenshot appended to the body as canvas
          //document.getElementById('eventsLog').appendChild(canvas);  
          //dataURL = canvas.toDataURL();  
          //to print the screenshot in console use below line
         // console.log(base64image);
          /*
          overwolf.media.takeScreenshot(function(info) {
            if (typeof info.url === 'undefined') {
              console.error(info);
              return;
            }
            */
            
            //overwolf.windows.sendMessage("menu", {data:gameimage});
            
            //document.getElementById("eventsLog").innerHTML = "<img src='"+gameimage+"' width='500'/>";
            // following line is optional and it is to save the screenshot
            // on the server side. It initiates an ajax call
            //pushScreenshotToServer(dataURL); 
          //});
      }
    });
  </script>
</body>
</html>
